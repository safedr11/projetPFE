<!-- demande-details.component.html -->
<div *ngIf="loading" class="loading-spinner">
    <mat-spinner></mat-spinner>
  </div>
  
  <div *ngIf="!loading && demande" class="demande-details-container">
    <h2>Détails de la Demande</h2>
    
    <!-- Section Informations de base -->
    <mat-card class="section-card">
      <mat-card-header>
        <mat-card-title>Informations de base</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="detail-row">
          <span class="detail-label">Demandeur:</span>
          <span>{{ demande.demandeur }}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Client:</span>
          <span>{{ demande.client }}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Source de changement:</span>
          <span>{{ demande.sourceDeChangement }}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Description:</span>
          <span>{{ demande.description }}</span>
        </div>
      </mat-card-content>
    </mat-card>
  
    <!-- Section Étude de la demande -->
    <mat-card class="section-card">
      <mat-card-header>
        <mat-card-title>Étude de la demande</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="detail-row">
          <span class="detail-label">Service(s) impacté(s):</span>
          <span>{{ demande.impactedInfrastructure }}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Niveau d'impact:</span>
          <span>{{ demande.niveauImpact }}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Priorité:</span>
          <span>{{ demande.priorite }}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Catégorie:</span>
          <span>{{ demande.categorie }}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Statut:</span>
          <span>{{ demande.status }}</span>
        </div>
      </mat-card-content>
    </mat-card>
  
    <!-- Section Ressources -->
    <mat-card class="section-card" *ngIf="demande.ressources">
      <mat-card-header>
        <mat-card-title>Ressources nécessaires</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="detail-row">
          <span class="detail-label">Ressources humaines:</span>
          <span>{{ demande.ressources.humanResources || 'Non spécifié' }}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Ressources matérielles:</span>
          <span>{{ demande.ressources.materialResources || 'Non spécifié' }}</span>
        </div>
      </mat-card-content>
    </mat-card>
  
    <!-- Section Évaluation des risques -->
    <mat-card class="section-card" *ngIf="demande.riskAssessment">
      <mat-card-header>
        <mat-card-title>Évaluation des risques</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <!-- Disponibilité -->
        <div *ngIf="demande.riskAssessment.disponibilite" class="risk-section">
          <h3>Disponibilité</h3>
          <div class="detail-row">
            <span class="detail-label">Description:</span>
            <span>{{ demande.riskAssessment.disponibilite.description || 'Non spécifié' }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Impact:</span>
            <span>{{ demande.riskAssessment.disponibilite.impactValue }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Probabilité:</span>
            <span>{{ demande.riskAssessment.disponibilite.probability }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Commentaires RSSI:</span>
            <span>{{ demande.riskAssessment.disponibilite.rssiComments || 'Aucun commentaire' }}</span>
          </div>
        </div>
  
        <!-- Intégrité -->
        <div *ngIf="demande.riskAssessment.integrite" class="risk-section">
          <h3>Intégrité</h3>
          <div class="detail-row">
            <span class="detail-label">Description:</span>
            <span>{{ demande.riskAssessment.integrite.description || 'Non spécifié' }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Impact:</span>
            <span>{{ demande.riskAssessment.integrite.impactValue }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Probabilité:</span>
            <span>{{ demande.riskAssessment.integrite.probability }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Commentaires RSSI:</span>
            <span>{{ demande.riskAssessment.integrite.rssiComments || 'Aucun commentaire' }}</span>
          </div>
          
        </div>
  
        <!-- Confidentialité -->
        <div *ngIf="demande.riskAssessment.confidentialite" class="risk-section">
          <h3>Confidentialité</h3>
          <div class="detail-row">
            <span class="detail-label">Description:</span>
            <span>{{ demande.riskAssessment.confidentialite.description || 'Non spécifié' }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Impact:</span>
            <span>{{ demande.riskAssessment.confidentialite.impactValue }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Probabilité:</span>
            <span>{{ demande.riskAssessment.confidentialite.probability }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Commentaires RSSI:</span>
            <span>{{ demande.riskAssessment.confidentialite.rssiComments || 'Aucun commentaire' }}</span>
          </div>
          
        </div>
      </mat-card-content>
    </mat-card>
  
    <!-- Section Actions techniques -->
    <mat-card class="section-card" *ngIf="demande.technicalActions && demande.technicalActions.length > 0">
      <mat-card-header>
        <mat-card-title>Actions techniques</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <mat-accordion>
          <mat-expansion-panel *ngFor="let action of demande.technicalActions">
            <mat-expansion-panel-header>
              <mat-panel-title>
                Action #{{ action.actionNumber }} - {{ action.description }}
              </mat-panel-title>
              <mat-panel-description>
                Statut: {{ action.status }}
              </mat-panel-description>
            </mat-expansion-panel-header>
            
            <div class="detail-row">
              <span class="detail-label">Responsable:</span>
              <span>{{ action.responsable }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Date planifiée:</span>
              <span>{{ action.plannedDate | frenchDate }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Type d'action:</span>
              <span>{{ action.actionType }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Commentaires:</span>
              <span>{{ action.comments || 'Aucun commentaire' }}</span>
            </div>
          </mat-expansion-panel>
        </mat-accordion>
      </mat-card-content>
    </mat-card>
  
    <div class="actions-container">
      <button mat-raised-button color="primary" (click)="goBack()">Retour</button>
    </div>
  </div>